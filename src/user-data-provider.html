<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-meta/iron-meta.html">

<dom-module id="user-data-provider">

  <template>
    <iron-ajax
      auto
      method="get"
      url="[[apiEndPoint]]/rest/mock/users"
      headers={{headers}}
      handle-as="json"
      content-type="application/json"
      on-response="_handleResponse">
    </iron-ajax>
  </template>
  <script>
    class UserDataProvider extends Polymer.Element {
      static get is() {
        return 'user-data-provider';
      }
      static get properties() {
        return {
          apiEndPoint: {
            type: String,
            value: 'http://proveng.cloud.provectus-it.com'
          },
          headers: {
            type: String,
            computed: '_getHeaders()'
          },
          data: {
            type: Array,
            notify: true
          },
          sortProperty: {
            type: String,
            observer: '_sortPropertyChanged'
          }
        }
      }
      _handleResponse(event) {
        this.data = event.detail.response.result;
      }

      _getHeaders() {
        let _customHeader = new Polymer.IronMeta({key: 'localToken'}).value;
        return {token: _customHeader};
      }

      _sortPropertyChanged(sort) {
        let property = [sort.split(/,/)];
        let head = property[0][0];
        let direction = property[0][1];

        let compare;
        switch (direction){
          case 'asc':
            compare = function (a, b) {
              return a.firstName > b.firstName;
            };
            break;
          case 'desc':
            compare = function (a, b) {
              return b.firstName > a.firstName;
            };
            break;
        }

        this.data.sort(compare);
      }
    }
    window.customElements.define(UserDataProvider.is, UserDataProvider);
  </script>
</dom-module>